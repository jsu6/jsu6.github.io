<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Animation Timing Difference Demo</title>
<style>
  body {
    font-family: sans-serif;
    padding: 20px;
  }
  #box {
    width: 40px;
    height: 40px;
    background: black;
    margin-top: 20px;
  }
  #chart {
    margin-top: 20px;
    white-space: pre;
    font-family: monospace;
    background: #f0f0f0;
    padding: 12px;
    border-radius: 6px;
  }
</style>
</head>
<body>

<h2>Animation Timing Difference Demo</h2>
<p>
This demo visualizes how animation frame timing varies depending on the device, CPU load, browser, and display refresh rate.
It does <strong>not</strong> store or fingerprint anythingâ€”it only shows live measurements on this page.
</p>

<div id="box"></div>
<div id="chart"></div>

<script>
// Animation target
const box = document.getElementById("box");

// Run a smooth left-right animation continuously
const animation = box.animate(
  [
    { transform: "translateX(0px)" },
    { transform: "translateX(400px)" }
  ],
  { duration: 1000, iterations: Infinity }
);

const chart = document.getElementById("chart");

// Store timing samples & intervals
let lastTime = null;
let deltas = [];

function loop() {
  const t = animation.currentTime;

  if (lastTime !== null && t !== null) {
    const delta = t - lastTime;
    deltas.push(delta);
    if (deltas.length > 300) deltas.shift(); // keep last 300 deltas
  }

  lastTime = t;
  drawStats();
  requestAnimationFrame(loop);
}

function drawStats() {
  if (deltas.length < 5) {
    chart.textContent = "Collecting frame timing data...";
    return;
  }

  // Calculate statistics
  const avg = deltas.reduce((a, b) => a + b, 0) / deltas.length;
  const min = Math.min(...deltas);
  const max = Math.max(...deltas);

  // Build a simple histogram
  const bins = {};
  for (let d of deltas) {
    const b = Math.round(d);
    bins[b] = (bins[b] || 0) + 1;
  }

  let hist = "";
  Object.keys(bins).sort((a, b) => a - b).forEach(bin => {
    hist += `${bin} ms | ${"#".repeat(bins[bin])}\n`;
  });

  // Display results
  chart.textContent =
    "Frame Interval Stats (last ~300 frames)\n" +
    "--------------------------------------\n" +
    `Average delta: ${avg.toFixed(2)} ms\n` +
    `Min delta:     ${min.toFixed(2)} ms\n` +
    `Max delta:     ${max.toFixed(2)} ms\n\n` +
    "Histogram of timing intervals:\n" +
    hist;
}

// Start sampling
loop();
</script>
</body>
</html>
