<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>WebGPU Fingerprinting PoC (Corrected AdapterInfo)</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 6px; }
    pre { white-space: pre-wrap; word-break: break-word; }
  </style>
</head>
<body>

<h2>WebGPU Fingerprinting – Working AdapterInfo</h2>
<div id="status"></div>

<table>
  <thead>
    <tr>
      <th>Property</th>
      <th>Condition</th>
      <th>Type</th>
      <th>Sample Value</th>
    </tr>
  </thead>
  <tbody id="out"></tbody>
</table>

<script>
async function run() {
  const out = document.getElementById("out");
  const status = document.getElementById("status");

  const add = (p, c, t, v) => {
    out.innerHTML += `
      <tr>
        <td>${p}</td>
        <td>${c}</td>
        <td>${t}</td>
        <td><pre>${v}</pre></td>
      </tr>`;
  };

  if (!navigator.gpu) {
    status.textContent = "WebGPU not supported.";
    return;
  }

  status.textContent = "Requesting GPU adapter…";

  const adapter = await navigator.gpu.requestAdapter({
    powerPreference: "high-performance"
  });

  if (!adapter) {
    status.textContent = "No adapter available.";
    return;
  }

  status.textContent = "Adapter acquired.";

  // ---- FIXED INFO (Chrome requires explicit whitelist!) ----
  let info = {};
  let condition = "";
  let type = "";

  if (typeof adapter.requestAdapterInfo === "function") {
    try {
      info = await adapter.requestAdapterInfo([
        "vendor",
        "architecture",
        "device",
        "description"
      ]);

      condition = "requestAdapterInfo() returned whitelisted fields";
      type = typeof info;

    } catch (err) {
      condition = "requestAdapterInfo() failed";
      type = "error";
      info = String(err);
    }
  } else {
    condition = "requestAdapterInfo() not supported";
    type = "n/a";
    info = "unavailable";
  }

  add("GPUAdapter.info", condition, type, JSON.stringify(info, null, 2));

  // ---- FEATURES ----
  const features = [...adapter.features];
  add("GPUAdapter.features", "features available", typeof adapter.features, JSON.stringify(features, null, 2));

  // ---- LIMITS ----
  const limits = {};
  for (const key of Object.keys(adapter.limits)) {
    limits[key] = adapter.limits[key];
  }
  add("GPUAdapter.limits", "limits available", typeof adapter.limits, JSON.stringify(limits, null, 2));

  // ---- FALLBACK ----
  add("GPUAdapter.isFallbackAdapter", "property present", typeof adapter.isFallbackAdapter, String(adapter.isFallbackAdapter));

  // ---- COMPAT MODE ----
  add("GPUAdapter.isCompatibilityMode", "property present", typeof adapter.isCompatibilityMode, String(adapter.isCompatibilityMode));

  status.textContent = "Done.";
}

run();
</script>

</body>
</html>
