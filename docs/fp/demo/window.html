<!doctype html>
<meta charset="utf-8">
<title>Window API Fingerprinting — Minimal PoC</title>
<body style="font-family:system-ui;padding:1rem">
<h3>Window API Fingerprinting — Minimal PoC</h3>
<button id="run">Run Test</button>
<pre id="out">Click “Run Test”.</pre>

<script>
const out = document.getElementById("out");
const log = (...a) => out.textContent += a.join(" ") + "\n";

document.getElementById("run").onclick = async () => {
  out.textContent = "";

  // open a popup so move/resize calls can succeed
  const w = window.open("", "", "width=400,height=300,left=50,top=50");
  if (!w) { log("Popup blocked — allow popups to test."); return; }

  const results = {};

  try {
    const before = {x:w.screenX, y:w.screenY, w:w.outerWidth, h:w.outerHeight};
    w.moveBy(15, 10);
    const after = {x:w.screenX, y:w.screenY, w:w.outerWidth, h:w.outerHeight};
    results.moveBy = {dx:after.x-before.x, dy:after.y-before.y};
  } catch(e) { results.moveBy = "error:"+e.name; }

  try {
    const before = {x:w.screenX, y:w.screenY};
    w.moveTo(5,5);
    const after = {x:w.screenX, y:w.screenY};
    results.moveTo = {x:after.x, y:after.y};
  } catch(e) { results.moveTo = "error:"+e.name; }

  try {
    const before = {w:w.outerWidth, h:w.outerHeight};
    w.resizeBy(40,25);
    const after = {w:w.outerWidth, h:w.outerHeight};
    results.resizeBy = {dw:after.w-before.w, dh:after.h-before.h};
  } catch(e) { results.resizeBy = "error:"+e.name; }

  try {
    w.resizeTo(480,360);
    results.resizeTo = {finalW:w.outerWidth, finalH:w.outerHeight};
  } catch(e) { results.resizeTo = "error:"+e.name; }

  try {
    w.print();
    results.print = "print() called (may open dialog or be blocked)";
  } catch(e) { results.print = "error:"+e.name; }

  try {
    const tt = w.trustedTypes;
    results.trustedTypes = tt ? {
      supported:true,
      names: (typeof tt.getPolicyNames === "function") ? tt.getPolicyNames() : null
    } : {supported:false};
  } catch(e) { results.trustedTypes = "error:"+e.name; }

  log("Fingerprint-like results:");
  log(JSON.stringify(results, null, 2));

  // simple hash to compare across runs
  const enc = new TextEncoder().encode(JSON.stringify(results));
  const buf = await crypto.subtle.digest("SHA-256", enc);
  const hash = [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,"0")).join("");
  log("\nSHA-256 hash (first 16 chars): " + hash.slice(0,16));
};
</script>
