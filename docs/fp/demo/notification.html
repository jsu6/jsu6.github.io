<!doctype html>
<html lang="en">
<meta charset="utf-8">
<title>Comprehensive Notification API Fingerprinting Demo</title>
<body style="font-family:system-ui;padding:1rem;white-space:pre-wrap">
<h2>Notification API Fingerprinting + Timing Demo</h2>
<p>This educational demo combines <b>feature detection</b> and <b>timing analysis</b> to show how Notification APIs 
can reveal browser, OS, and permission characteristics. 
No data leaves your device.</p>

<button id="run">Run Notification Demo</button>
<pre id="out">Ready...</pre>

<script>
const log = (...a) => out.textContent += a.join(' ') + '\n';

document.getElementById('run').onclick = async () => {
  out.textContent = '';
  log('[Notification API Feature Inspection]\n');

  if (!('Notification' in window)) {
    log('❌ Notification API not supported.');
    return;
  }

  // 1. === Feature presence vector ===
  const props = [
    'maxActions', 'permission', 'requestPermission',
    'actions', 'badge', 'body', 'dir', 'icon', 'image',
    'lang', 'renotify', 'requireInteraction', 'showTrigger',
    'silent', 'tag', 'timestamp', 'title', 'vibrate'
  ];

  let trueCount = 0, falseCount = 0;

  for (const p of props) {
    const supported = (p in Notification) || (p in Notification.prototype);
    log(`${p.padEnd(20)} : ${supported}`);
    if (supported) trueCount++;
    else falseCount++;
  }

  log('\n[Feature Summary]');
  log(`Supported (true): ${trueCount}`);
  log(`Unsupported (false): ${falseCount}`);
  log(`Total checked: ${props.length}`);

  log('\n[Feature Values]');
  log('maxActions =', Notification.maxActions);
  log('permission =', Notification.permission);

  // 2. === Request permission ===
  if (Notification.permission !== 'granted') {
    try {
      const result = await Notification.requestPermission();
      log('requestPermission() ->', result);
      if (result !== 'granted') {
        log('❌ Permission not granted, aborting notification test.');
        return;
      }
    } catch(e) {
      log('Permission request error:', e.message);
      return;
    }
  } else {
    log('Already granted.');
  }

  // 3. === Create and measure timing of notification ===
  const t0 = performance.now();
  log('\n[Notification Timing Inference]');
  log('Creating notification at', new Date().toLocaleTimeString(), '\n');

  const n = new Notification('Fingerprint Demo', {
    body: 'Testing notification appearance...',
    icon: 'https://via.placeholder.com/64',
    image: 'https://via.placeholder.com/128',
    tag: 'demoTag',
    requireInteraction: false,
    renotify: true,
    timestamp: Date.now()
  });

  let shown = false;

  n.onshow = () => {
    shown = true;
    const dt = (performance.now() - t0).toFixed(2);
    log(`✅ onshow fired after ${dt} ms`);
  };

  n.onclose = () => {
    const dt = (performance.now() - t0).toFixed(2);
    log(`ℹ️ onclose fired after ${dt} ms (user/system closed)`);
    if (!shown) {
      log('⚠️ Notification likely suppressed or auto-dismissed by OS.');
    }
  };

  n.onerror = (e) => {
    const dt = (performance.now() - t0).toFixed(2);
    log(`❌ onerror after ${dt} ms (${e.message || 'display error'})`);
  };

  // Fallback: if no onshow within 2s, assume suppressed
  setTimeout(() => {
    if (!shown) log('⚠️ No onshow within 2s → notification may be blocked or hidden.');
  }, 2000);

  // 4. === Environment summary ===
  log('\n[Environment Info]');
  log('navigator.platform:', navigator.platform);
  log('navigator.userAgent:', navigator.userAgent);
  log('Supports showTrigger:', 'showTrigger' in Notification.prototype);
  log('Supports vibration:', 'vibrate' in Notification.prototype);

  log('\n✅ Demo running — watch the output for timing differences and feature results.');
};
</script>
</body>
</html>
