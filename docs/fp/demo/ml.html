<!doctype html>
<html>
<body>
<button id="run">Run WebNN Fingerprint</button>
<pre id="out"></pre>

<script>
const out = document.getElementById('out');

function hash(arr) {
  let h = 0|0;
  for (let v of arr) {
    const x = Math.fround(v * 1e7) | 0;
    h = (h * 31 + x) | 0;
  }
  return (h >>> 0).toString(16).padStart(8, "0");
}

async function run() {
  if (!navigator.ml) {
    out.textContent = "WebNN unavailable";
    return;
  }

  const ctx = await navigator.ml.createContext();
  const builder = new MLGraphBuilder(ctx);

  const results = {};

  async function testOp(name, buildFn, dims=[1,8]) {
    try {
      const desc = { dataType: "float32", dimensions: dims };
      const input = builder.input("input", desc);

      // deterministic input
      const size = dims.reduce((a,b)=>a*b,1);
      const inp = new Float32Array(size);
      for (let i=0;i<size;i++) inp[i] = Math.sin(i*0.37);

      const outBuf = new Float32Array(size);

      const graphOut = buildFn(builder, input);
      const graph = await builder.build({ output: graphOut });

      const t0 = performance.now();
      await ctx.compute(graph, { input: inp }, { output: outBuf });
      const t1 = performance.now();

      results[name] = {
        hash: hash(outBuf),
        timeMs: +(t1 - t0).toFixed(4)
      };
    } catch (e) {
      results[name] = { error: e.message };
    }
  }

  // ---------- ACTUAL OPS ----------
  await testOp("relu", (b, x) => b.relu(x));
  await testOp("sigmoid", (b, x) => b.sigmoid(x));
  await testOp("tanh", (b, x) => b.tanh(x));

  // linear model (weights using valid descriptors)
  await testOp("linear", (b, x) => {
    const w = new Float32Array(64);
    for (let i=0;i<w.length;i++) w[i] = Math.sin(i*0.11);

    const bias = new Float32Array(8);
    const wDesc = { dataType: "float32", dimensions: [8, 8] };
    const bDesc = { dataType: "float32", dimensions: [8] };

    const Wc = b.constant(w, wDesc);
    const Bc = b.constant(bias, bDesc);

    return b.linear(x, Wc, { bias: Bc });
  });

  out.textContent = JSON.stringify(results, null, 2);
}

document.getElementById('run').onclick = run;
</script>
</body>
</html>
