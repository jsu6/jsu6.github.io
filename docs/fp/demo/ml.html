<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WebNN Minimal Tests</title>
</head>
<body>

<h2>WebNN Test Examples (Minimal UI)</h2>

<button onclick="runExample1()">Run Example 1</button>
<pre id="out1"></pre>

<button onclick="runExample2()">Run Example 2</button>
<pre id="out2"></pre>

<button onclick="runExample3()">Run Example 3 (MatMul)</button>
<pre id="out3"></pre>

<button onclick="runExample4()">Run Example 4 (Sin + Cos)</button>
<pre id="out4"></pre>

<button onclick="runExample5()">Run Example 5 (Broadcast + ReLU)</button>
<pre id="out5"></pre>

<button onclick="runExample6()">Run Example 6 (Mini MLP)</button>
<pre id="out6"></pre>

<script>

// ---------------------------------------------------------------------
// Helper functions
// ---------------------------------------------------------------------
function arr(a) {
  return '[' + Array.from(a).join(', ') + ']';
}

// ---------------------------------------------------------------------
// Example 1
// ---------------------------------------------------------------------
async function runExample1() {
  const out = document.getElementById("out1");
  out.textContent = "Running Example 1...";

  const TENSOR_SHAPE = [1,2,2,2];
  const TENSOR_SIZE = 8;

  const ctx = await navigator.ml.createContext();
  const b = new MLGraphBuilder(ctx);

  const desc = { dataType:"float32", shape:TENSOR_SHAPE };

  const c1 = b.constant(desc, new Float32Array(TENSOR_SIZE).fill(0.5));
  const c2 = b.constant(desc, new Float32Array(TENSOR_SIZE).fill(0.5));

  const in1 = b.input("in1", desc);
  const in2 = b.input("in2", desc);

  const a1 = b.add(c1, in1);
  const a2 = b.add(c2, in2);
  const Y  = b.mul(a1, a2);

  const graph = await b.build({Y});

  const t1 = await ctx.createTensor({dataType:"float32", shape:TENSOR_SHAPE, writable:true});
  const t2 = await ctx.createTensor({dataType:"float32", shape:TENSOR_SHAPE, writable:true});
  const tY = await ctx.createTensor({dataType:"float32", shape:TENSOR_SHAPE, readable:true});

  const d1 = new Float32Array(TENSOR_SIZE).fill(1.0);
  const d2 = new Float32Array(TENSOR_SIZE).fill(0.8);

  await ctx.writeTensor(t1, d1);
  await ctx.writeTensor(t2, d2);

  await ctx.dispatch(graph, {in1:t1, in2:t2}, {Y:tY});

  const res = new Float32Array(await ctx.readTensor(tY));
  out.textContent =
    "Input1: " + arr(d1) + "\n" +
    "Input2: " + arr(d2) + "\n" +
    "Result: " + arr(res);
}

// ---------------------------------------------------------------------
// Example 2
// ---------------------------------------------------------------------
async function runExample2() {
  const out = document.getElementById("out2");
  out.textContent = "Running Example 2...";

  const desc = { dataType:"float32", shape:[2,2] };

  const ctx = await navigator.ml.createContext();
  const b = new MLGraphBuilder(ctx);

  const A = b.input("A", desc);
  const B = b.input("B", desc);
  const k = b.constant(desc, new Float32Array(4).fill(0.2));
  const C = b.add(b.mul(A, k), B);

  const graph = await b.build({C});

  const tA = await ctx.createTensor({...desc, writable:true});
  const tB = await ctx.createTensor({...desc, writable:true});
  const tC = await ctx.createTensor({dataType:"float32", shape:[2,2], readable:true});

  const dA = new Float32Array(4).fill(1.0);
  const dB = new Float32Array(4).fill(0.8);

  await ctx.writeTensor(tA, dA);
  await ctx.writeTensor(tB, dB);

  await ctx.dispatch(graph, {A:tA, B:tB}, {C:tC});

  const res = new Float32Array(await ctx.readTensor(tC));

  out.textContent =
    "A: " + arr(dA) + "\n" +
    "B: " + arr(dB) + "\n" +
    "C = 0.2*A + B = " + arr(res);
}

// ---------------------------------------------------------------------
// Example 3 – MatMul
// ---------------------------------------------------------------------
async function runExample3() {
  const out = document.getElementById("out3");
  out.textContent = "Running Example 3...";

  const ctx = await navigator.ml.createContext();
  const b = new MLGraphBuilder(ctx);

  const A = b.input("A", {dataType:"float32", shape:[2,3]});
  const B = b.input("B", {dataType:"float32", shape:[3,2]});
  const M = b.matmul(A,B);

  const graph = await b.build({M});

  const tA = await ctx.createTensor({dataType:"float32", shape:[2,3], writable:true});
  const tB = await ctx.createTensor({dataType:"float32", shape:[3,2], writable:true});
  const tM = await ctx.createTensor({dataType:"float32", shape:[2,2], readable:true});

  const dA = new Float32Array([1,2,3, 4,5,6]);
  const dB = new Float32Array([7,8, 9,10, 11,12]);

  await ctx.writeTensor(tA, dA);
  await ctx.writeTensor(tB, dB);

  await ctx.dispatch(graph, {A:tA, B:tB}, {M:tM});

  const res = new Float32Array(await ctx.readTensor(tM));

  out.textContent =
    "A: " + arr(dA) + "\n" +
    "B: " + arr(dB) + "\n" +
    "A×B = " + arr(res);
}

// ---------------------------------------------------------------------
// Example 4 – sin(x) + cos(x)
// ---------------------------------------------------------------------
async function runExample4() {
  const out = document.getElementById("out4");
  out.textContent = "Running Example 4...";

  const ctx = await navigator.ml.createContext();
  const b = new MLGraphBuilder(ctx);

  const X = b.input("X", {dataType:"float32", shape:[4]});
  const Y = b.add(b.sin(X), b.cos(X));

  const graph = await b.build({Y});

  const tX = await ctx.createTensor({dataType:"float32", shape:[4], writable:true});
  const tY = await ctx.createTensor({dataType:"float32", shape:[4], readable:true});

  const dX = new Float32Array([0, Math.PI/2, Math.PI, 3*Math.PI/2]);

  await ctx.writeTensor(tX, dX);
  await ctx.dispatch(graph, {X:tX}, {Y:tY});

  const res = new Float32Array(await ctx.readTensor(tY));

  out.textContent =
    "X: " + arr(dX) + "\n" +
    "sin(x)+cos(x): " + arr(res);
}

// ---------------------------------------------------------------------
// Example 5 – Broadcast + ReLU
// ---------------------------------------------------------------------
async function runExample5() {
  const out = document.getElementById("out5");
  out.textContent = "Running Example 5...";

  const ctx = await navigator.ml.createContext();
  const b = new MLGraphBuilder(ctx);

  const desc = {dataType:"float32", shape:[1,2,2,3]};
  const X = b.input("X", desc);

  const scale = b.constant({dataType:"float32", shape:[1,1,1,3]},
                           new Float32Array([1.0,0.5,2.0]));

  const bias = b.constant({dataType:"float32", shape:[1,1,1,3]},
                          new Float32Array([0.1,-0.2,0.3]));

  const Y = b.relu(b.add(b.mul(X,scale), bias));

  const graph = await b.build({Y});

  const tX = await ctx.createTensor({...desc, writable:true});
  const tY = await ctx.createTensor({dataType:"float32", shape:[1,2,2,3], readable:true});

  const dX = new Float32Array([
     1,2,3,
     4,5,6,
     1,1,1,
     0,0.5,2
  ]);

  await ctx.writeTensor(tX, dX);
  await ctx.dispatch(graph, {X:tX}, {Y:tY});

  const res = new Float32Array(await ctx.readTensor(tY));

  out.textContent =
    "Input X: " + arr(dX) + "\n" +
    "Output Y: " + arr(res);
}

// ---------------------------------------------------------------------
// Example 6 – Mini MLP
// ---------------------------------------------------------------------
async function runExample6() {
  const out = document.getElementById("out6");
  out.textContent = "Running Example 6...";

  const ctx = await navigator.ml.createContext();
  const b = new MLGraphBuilder(ctx);

  const X = b.input("X", {dataType:"float32", shape:[1,4]});

  function dense(input, inF, outF) {
    const W = b.constant(
      {dataType:"float32", shape:[inF,outF]},
      new Float32Array(inF*outF).fill(0.1)
    );
    const B = b.constant(
      {dataType:"float32", shape:[1,outF]},
      new Float32Array(outF).fill(0.01)
    );
    return b.relu(b.add(b.matmul(input, W), B));
  }

  const L1 = dense(X,4,6);
  const L2 = dense(L1,6,6);
  const L3 = dense(L2,6,4);
  const Y  = dense(L3,4,2);

  const graph = await b.build({Y});

  const tX = await ctx.createTensor({dataType:"float32", shape:[1,4], writable:true});
  const tY = await ctx.createTensor({dataType:"float32", shape:[1,2], readable:true});

  await ctx.writeTensor(tX, new Float32Array([1,2,3,4]));

  await ctx.dispatch(graph, {X:tX}, {Y:tY});

  const res = new Float32Array(await ctx.readTensor(tY));

  out.textContent =
    "Input: [1,2,3,4]\n" +
    "MLP Output: " + arr(res);
}

</script>

</body>
</html>
