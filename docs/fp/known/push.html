<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PushManager.supportedContentEncodings Demo</title>
  <style>
    body { font-family: monospace; padding: 1.5em; background: #f6f6f6; }
    pre { background: white; padding: 1em; border-radius: 8px; box-shadow: 0 0 4px rgba(0,0,0,0.1); }
    button { padding: 0.5em 1em; margin-top: 1em; }
  </style>
</head>
<body>
  <h2>PushManager.supportedContentEncodings Demo</h2>
  <button id="registerBtn">Register & Subscribe</button>
  <div id="output"><pre>Waiting...</pre></div>

  <script>
    async function main() {
      const out = document.getElementById('output');
      const log = (obj) => out.innerHTML = `<pre>${JSON.stringify(obj, null, 2)}</pre>`;

      if (!('serviceWorker' in navigator)) {
        log({ error: 'Service Worker not supported in this browser.' });
        return;
      }

      if (!('PushManager' in window)) {
        log({ error: 'PushManager API not supported in this browser.' });
        return;
      }

      try {
        // Register service worker
        const reg = await navigator.serviceWorker.register('sw.js');
        console.log('Service worker registered:', reg);

        // Request permission for notifications
        const permission = await Notification.requestPermission();
        if (permission !== 'granted') {
          log({ error: 'Notification permission not granted.' });
          return;
        }

        // Subscribe for push notifications
        const subscription = await reg.pushManager.subscribe({
          userVisibleOnly: true,
          applicationServerKey: undefined // Replace with your VAPID key for production
        });

        // Get supported encodings
        const encodings = PushManager.supportedContentEncodings || [];

        // Construct object to display
        const subscriptionObject = {
          endpoint: subscription.endpoint,
          keys: {
            p256dh: btoa(String.fromCharCode.apply(
              null, new Uint8Array(subscription.getKey('p256dh') || []))),
            auth: btoa(String.fromCharCode.apply(
              null, new Uint8Array(subscription.getKey('auth') || []))),
          },
          encoding: encodings,
        };

        log({
          supportedEncodings: encodings,
          subscription: subscriptionObject
        });

      } catch (err) {
        log({ error: err.message });
      }
    }

    document.getElementById('registerBtn').onclick = main;
  </script>
</body>
</html>
