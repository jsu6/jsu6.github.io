<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Minimal DeviceOrientation PoC</title>
  <style>
    body{font-family:system-ui, -apple-system, Arial; padding:18px}
    .v{font-family:monospace; font-size:1.1rem}
    button{padding:6px 10px; margin-right:6px}
  </style>
</head>
<body>
  <h2>Minimal DeviceOrientation PoC</h2>

  <div>
    <button id="start">Start</button>
    <button id="stop" disabled>Stop</button>
  </div>

  <p>alpha: <span id="alpha" class="v">—</span></p>
  <p>beta:  <span id="beta"  class="v">—</span></p>
  <p>gamma: <span id="gamma" class="v">—</span></p>

<script>
const startBtn = document.getElementById('start');
const stopBtn  = document.getElementById('stop');
const a = document.getElementById('alpha');
const b = document.getElementById('beta');
const g = document.getElementById('gamma');

let handler = null;

function fmt(x){ return x == null ? 'null' : Number(x).toFixed(2); }

async function start(){
  if (typeof DeviceOrientationEvent === 'undefined'){
    alert('DeviceOrientationEvent not supported.');
    return;
  }

  // iOS 13+ requires permission via requestPermission()
  if (typeof DeviceOrientationEvent.requestPermission === 'function'){
    try {
      const res = await DeviceOrientationEvent.requestPermission();
      if (res !== 'granted'){ alert('Permission denied'); return; }
    } catch (e) {
      alert('Permission request failed: ' + e);
      return;
    }
  }

  handler = (ev) => {
    a.textContent = fmt(ev.alpha);
    b.textContent = fmt(ev.beta);
    g.textContent = fmt(ev.gamma);
  };

  window.addEventListener('deviceorientation', handler, true);
  startBtn.disabled = true;
  stopBtn.disabled = false;
}

function stop(){
  if (handler) window.removeEventListener('deviceorientation', handler, true);
  handler = null;
  startBtn.disabled = false;
  stopBtn.disabled = true;
}

startBtn.addEventListener('click', start);
stopBtn.addEventListener('click', stop);
</script>
</body>
</html>
